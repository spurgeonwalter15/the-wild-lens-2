<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VR Remote - Res Control</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <style>
        body { background: #111; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; margin: 0; }
        h1 { color: #00ffcc; letter-spacing: 2px; text-transform: uppercase; font-size: 24px; margin-top: 20px;}
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 440px; margin: 20px auto; }
        button { padding: 25px; border: none; border-radius: 12px; background: #222; color: #eee; font-size: 16px; cursor: pointer; border: 1px solid #444; font-weight: bold; transition: 0.1s;}
        button:hover { background: #333; }
        button:active { background: #00ffcc; color: #000; transform: scale(0.98); }
        
        .bird-btn { background: #305; border-color: #60a; color: #eaf;}
        .bird-btn:hover { background: #407;}

        .seq-btn { background: #055; border-color: #0aa; grid-column: span 2; color: #0ff;}
        .seq-btn:hover { background: #077; }
        
        #status { font-size: 14px; color: #ff4444; margin-bottom: 20px; font-weight: bold; }
        
        .slider-box { background: #1a1a1a; max-width: 440px; margin: 20px auto; padding: 20px; border-radius: 12px; border: 1px solid #333; text-align: left; box-sizing: border-box;}
        input[type=range] { width: 100%; margin: 15px 0; accent-color: #00ffcc; cursor: pointer;}
        .sens-label { display: flex; justify-content: space-between; font-size: 14px; color: #aaa; margin-bottom: 5px;}
        .val-text { color: #00ffcc; font-weight: bold; font-size: 16px; }

        /* NEW: Resolution Button Styles */
        .res-container { display: flex; gap: 10px; margin-top: 10px; }
        .res-btn { padding: 15px 10px; font-size: 14px; flex: 1; border-radius: 8px; background: #2a2a2a; color: #ccc;}
        .res-btn:hover { background: #444; }
        .res-btn:active { background: #ffaa00; color: #000; }
    </style>
</head>
<body>
    <h1>Director Control</h1>
    <div id="status">Connecting to Headset...</div>
    
    <div class="grid">
        <button onclick="send('mode:normal')">Human</button>
        <button onclick="send('mode:dog')">Dog</button>
        <button onclick="send('mode:horse')">Horse</button>
        <button onclick="send('mode:deer')">Deer</button>
        <button onclick="send('mode:nightjar')">Nightjar</button>
        <button class="bird-btn" onclick="send('mode:hummingbird')">Hummingbird</button>
        
        <button id="seq-btn" class="seq-btn" onclick="toggleSequence()">ðŸ”„ START AUTO-SEQUENCE (15s)</button>
    </div>

    <div class="slider-box">
        <div class="sens-label">
            <span>Live Camera Quality</span>
        </div>
        <div class="res-container">
            <button class="res-btn" onclick="sendRaw('res:720')">720p (Fast)</button>
            <button class="res-btn" onclick="sendRaw('res:1080')">1080p (HD)</button>
            <button class="res-btn" onclick="sendRaw('res:4k')">4K (Max)</button>
        </div>
    </div>

    <div class="slider-box">
        <div class="sens-label">
            <span>Nightjar Motion Sensitivity</span>
            <span class="val-text" id="sens-val">50</span>
        </div>
        <input type="range" min="10" max="150" value="50" 
               oninput="document.getElementById('sens-val').innerText = this.value"
               onchange="sendRaw('sens:'+this.value)">
    </div>

    <div class="slider-box">
        <div class="sens-label">
            <span>Field of View (Zoom)</span>
            <span class="val-text"><span id="fov-val">1.00</span>x</span>
        </div>
        <input type="range" min="50" max="200" value="100" 
               oninput="document.getElementById('fov-val').innerText = (this.value / 100).toFixed(2)"
               onchange="sendRaw('fov:' + (this.value / 100))">
    </div>

    <script>
        const TOPIC = "VR_PROJECT_DOOD_9876"; 
        const client = new Paho.MQTT.Client("broker.hivemq.com", 8884, "rem_" + Math.random().toString(16).slice(2));

        let sequenceTimer = null;
        let seqIndex = 0;
        const seqModes = ['normal', 'dog', 'horse', 'deer', 'nightjar', 'hummingbird'];

        client.connect({ 
            useSSL: true,
            onSuccess: () => {
                const stat = document.getElementById('status');
                stat.innerText = "ONLINE: Linked to VR Headset";
                stat.style.color = "#00ffcc";
            },
            onFailure: (err) => {
                const stat = document.getElementById('status');
                stat.innerText = "CONNECTION FAILED. Retrying...";
                stat.style.color = "#ff4444";
            }
        });

        function toggleSequence() {
            if (sequenceTimer) {
                stopSequence();
            } else {
                document.getElementById('seq-btn').innerText = "ðŸ›‘ STOP SEQUENCE";
                document.getElementById('seq-btn').style.background = "#800";
                document.getElementById('seq-btn').style.color = "#fff";
                
                seqIndex = 0;
                triggerSequenceStep();
                sequenceTimer = setInterval(triggerSequenceStep, 15000); 
            }
        }

        function triggerSequenceStep() {
            let mode = seqModes[seqIndex];
            sendRaw('mode:' + mode);
            seqIndex++;
            if (seqIndex >= seqModes.length) seqIndex = 0;
        }

        function stopSequence() {
            if (sequenceTimer) {
                clearInterval(sequenceTimer);
                sequenceTimer = null;
                let btn = document.getElementById('seq-btn');
                btn.innerText = "ðŸ”„ START AUTO-SEQUENCE (15s)";
                btn.style.background = "#055";
                btn.style.color = "#0ff";
            }
        }

        function send(p) {
            stopSequence(); 
            sendRaw(p);
        }

        function sendRaw(p) {
            if (!client.isConnected()) {
                alert("Wait for connection to establish.");
                return;
            }
            const m = new Paho.MQTT.Message(p);
            m.destinationName = TOPIC;
            client.send(m);
        }
    </script>
</body>
</html>
